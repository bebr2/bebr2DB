# bebr2DB

## 简介

本仓库为2022年秋THU数据库系统概论的大作业。

总代码量约为4500行（不包括antlr4生成的代码，不包括自己设计的测试代码，但包括空行和注释），主要使用python语言编写，GUI前端部分使用html + js语言编写。

本项目在SystemManager之外（即索引、记录管理、文件系统等）自我感觉实现得挺好，但是SystemManager中的各种接口实现实在是**依托答辩**，究其原因有两点：

1. 这部分是在阳后不久写的，而且当时有期末考试，精神状态很差；
2. 事先没有规划好要实现的功能，导致后来在加功能的时候，代码出现很多重复等等，导致出了许多bug。

总结就是，本项目实现了数据库CLI和GUI的基本运行，实现了系统管理、查询解析（包括双表JOIN），非联合主外键完整性约束、模糊查询、聚合查询、分组查询、分页查询、UNIQUE约束、NULL约束、数据库的事务性等功能。代码写得**很差**，求轻喷。

详细的框架介绍都在`./report/项目总结报告.md`中，`./mytest`文件夹下是一些模块的单独测试。

### 给后来者的建议

首先，在期末考前一定要实现大部分，不然很搞心态（特别是身体不太好的同学，要是那段时间阳了很伤）。

GUI真的很建议用eel库实现，直接用html+css+js/vue，可以让你的前端有很高的上限，并且无缝衔接软工，没有任何痛点，甚至vue的表格能直接帮你完美展示几十万条结果。不太建议用pyqt5，当然很熟悉qt的大佬请无视。

以上也是用python的好处（日期、聚合查询应该都可以直接调用相关的包）。

先规划好要实现的功能，否则会和我一样，前面功能的实现没考虑新增的功能（特别是SELECT语句的处理），导致很多代码需要修改。

如果觉得自己的实现会有很多bug，那就多加一些功能来抵消（我实现的功能大约是95分，最后因为bug估计扣了快十分，单人实现乘以1.5也很容易就90了

## 使用指南

本数据库可以使用命令行CLI版本，以及基于python的eel库、js和html搭建的GUI（实际上是一个Web前端）。

### 环境说明

**python版本：**在3.6和3.8下均可执行。

**其他依赖库：**

> click==7.1.2
>
> colorama==0.4.4
>
> numpy==1.21.5
>
> prettytable==3.6.0
>
> antlr4-python3-runtime==4.11.1
>
> Eel==0.15.1

其中Eel库只在GUI版本使用到，colorama库、click库只在CLI版本使用到（事实上prettytable也是只在CLI版本使用到，但`web.py`代码执行时调用`SQLOutput.py`中也会导入它，可自行删除）

**系统：**

CLI版本在ubuntu 20.04可以稳定运行。GUI版本只能在windows系统运行，且需要安装Chrome浏览器（如果只有其他浏览器，需要修改`web.py`的`eel.init()`函数，具体见官方文档，且不保证能稳定运行）。

由于GUI版本使用了vue、eel等库，是通过cdn资源导入的，所以需要**保证网络畅通**（正常情况下国内节点应该没问题），同时因为使用8080端口，如果该端口已被占用需要在`eel.start`函数中修改为其他端口号。

由于win10下python的os.lseek只能偏移2GB，因此在win10下运行CLI或GUI版本时，涉及到2GB以上文件的操作可能出现问题。

### GUI版本

在`README.md`的目录下命令行执行：

```
python3 web.py
```

输出欢迎信息后会自动使用Chrome浏览器打开一个GUI前端页面。

退出程序时，关闭该前端页面即可。

### CLI版本

在`README.md`的目录下命令行执行：

```
python3 cli.py
```

输出欢迎信息后会在命令行出现CLI交互界面。

退出程序时请**不要**使用Ctrl+C，否则缓存中的页面可能不会被写回，而是使用q或quit命令退出。

## 已知bug和可以改进的地方

在聚合查询时会出现select条件没使用全的bug。

在助教验收时候，出现了切换数据库时没有保存当前数据库信息的bug，**现在应该已经解决了。**

B+树索引时，**不应该给重复值重新开一个页**，而是给同一页提供相同的溢出页就行了，否则会导致所占的储存空间多出很多。

本项目一定还有许许多多的bug，但是我已经懒得查找修改了（

